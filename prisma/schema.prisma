generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id                String          @id @default(uuid())
  nome              String
  email             String          @unique
  senha             String
  telefone          String?
  avatar_url        String?
  tipo              TipoUsuario     @default(PASSAGEIRO)
  
  corridas_passageiro Corrida[]     @relation("PassageiroCorridas")
  corridas_motorista  Corrida[]     @relation("MotoristaCorridas")
  locais_salvos       LocalSalvo[]
  
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  @@index([email])
}

enum TipoUsuario {
  PASSAGEIRO
  MOTORISTA
}

model Corrida {
  id                    String      @id @default(uuid())
  status                StatusCorrida @default(PENDENTE)
  
  latitude_origem       Float
  longitude_origem      Float
  endereco_origem       String
  
  latitude_destino      Float
  longitude_destino     Float
  endereco_destino      String
  
  preco                 Decimal     @db.Decimal(10, 2)
  distancia             Float?      
  duracao               Int?        

  id_passageiro         String
  passageiro            Usuario     @relation("PassageiroCorridas", fields: [id_passageiro], references: [id])
  
  id_motorista          String?
  motorista             Usuario?    @relation("MotoristaCorridas", fields: [id_motorista], references: [id])
  
  avaliacao             Avaliacao?

  createdAt             DateTime    @default(now())
  updatedAt             DateTime    @updatedAt

  @@index([status])
  @@index([id_motorista])
  @@index([id_passageiro])
}

enum StatusCorrida {
  PENDENTE
  ACEITA
  EM_ANDAMENTO
  CHEGOU
  CONCLUIDA
  CANCELADA
}

model LocalSalvo {
  id          String   @id @default(uuid())
  nome_local  String   
  endereco    String
  latitude    Float
  longitude   Float
  
  id_usuario  String
  usuario     Usuario  @relation(fields: [id_usuario], references: [id], onDelete: Cascade)

  @@index([id_usuario])
}

model Avaliacao {
  id          String   @id @default(uuid())
  nota        Int      
  comentario  String?  @db.Text
  
  id_corrida  String   @unique
  corrida     Corrida  @relation(fields: [id_corrida], references: [id])

  createdAt   DateTime @default(now())
}